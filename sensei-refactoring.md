------------

первое что бросается в глаза по структуре кода - использование функций вместо методов на структуре,
к примеру я бы ожидал увидеть структуру Repository и пару имплементаций TryFrom для оного, например
impl TryFrom<&Path> for Repository { ... }
impl TryFrom<&str> for Repository { ... } 
что позволило бы четко по коду понимать начальную сущность библиотеки - гет работает с репозиториями,
сам бы код выглядит как:
let repo = &mut Repository::try_from(some_path);

методы репозитория:
repo.commit() -> Result<(), Error>;
repo.restore(...) -> Result<(), Error>;

------------

Про декларативный клап - вроде говорил, старайся им пользоваться, один раз руками билдер набрать нужно,
просто что бы понимать во что дерайв парсера превращается, но далее стоит пытатся использовать ручной
привод только когда клап не может выразить декларативно то что ты хочешь (я пока таких случаев не встречал)

Для самой структуры, которая дерайвит клап, я бы просто написал отдельный impl блок, который бы понимал какую
комманду выполнить нужно и пользовался бы API Repository

------------

Насчет get, который не нужно импортировать - любая указанная в карго зависимость не нуждается в "прямом" 
импорте в простом случае.
Т.к. у тебя get это библиотека (lib.rs), но есть еще и main.rs то карго в состоянии понять что main.rs использует
get как зависимость, поэтому use get не нужен, но я обычно пишу для читаемости, хоть линтер иногда такие импорты и удаляет.

------------

create_working_dir - щас мясо, я бы поделил на отдельные приватные методы:
init_blob_dir(&self) -> Result<(), Error>;
init_worktree_dir(&self) -> Result<(), Error>;
...
init_dirs(&self) -> Result<(), Error>; // для аггрегации всех остальных методов, заодно и потестить каждый метод можно будет отдельно

------------

Worktree вижу как часть структуры Repository

Все методы worktree бы двинул в блок impl Repository { ... }

------------

Далее все теже замечания что и выше, есть структуры, но методы на структурах имплементированы как отдельные функции

дима мазурин, [5/22/23 12:13 PM]
я бы еще ебанул проперти тест какой, причем поверх директории которая монтировалась бы в ramfs

дима мазурин, [5/22/23 12:13 PM]
что бы не шуршать по диску лишний раз но при этом иметь возможность оттестировать любое безобразие

дима мазурин, [5/22/23 12:13 PM]
но думаю это нужно делать только после того как у тебя объекты доформируются (читай как структуры)

дима мазурин, [5/22/23 12:13 PM]
и апи публичное стабильное
